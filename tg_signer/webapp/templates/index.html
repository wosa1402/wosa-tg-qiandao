{% extends "base.html" %}
{% set show_nav = true %}
{% set title = "ä»ªè¡¨ç›˜ - TG Signer Web" %}

{% block content %}
  <div class="stats-grid">
    <div class="stat-card">
      <div class="stat-icon blue">ğŸ‘¤</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.accounts_logged_in }}</div>
        <div class="stat-label">å·²ç™»å½•è´¦å· / {{ stats.accounts_total }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon green">ğŸ“‹</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.tasks_enabled }}</div>
        <div class="stat-label">å·²å¯ç”¨ä»»åŠ¡ / {{ stats.tasks_total }}</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon orange">â–¶ï¸</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.runs_running }}</div>
        <div class="stat-label">è¿è¡Œä¸­å®ä¾‹</div>
      </div>
    </div>
    <div class="stat-card">
      <div class="stat-icon red">âŒ</div>
      <div class="stat-content">
        <div class="stat-value">{{ stats.runs_failed_recent }}</div>
        <div class="stat-label">æœ€è¿‘å¤±è´¥ï¼ˆæœ€è¿‘ 50 æ¬¡ï¼‰</div>
      </div>
    </div>
  </div>

  <div class="card mb-lg">
    <div class="card-header">
      <div class="card-title">âš¡ å¿«æ·æ“ä½œ</div>
    </div>
    <div class="card-body">
      <div class="quick-actions">
        <a class="quick-action" href="/accounts">
          <div class="quick-action-icon blue">ğŸ‘¤</div>
          <div class="quick-action-text">è´¦å·ç®¡ç†</div>
        </a>
        <a class="quick-action" href="/tasks">
          <div class="quick-action-icon green">ğŸ“‹</div>
          <div class="quick-action-text">ä»»åŠ¡é…ç½®</div>
        </a>
        <a class="quick-action" href="/runs">
          <div class="quick-action-icon orange">â–¶ï¸</div>
          <div class="quick-action-text">è¿è¡Œè®°å½•</div>
        </a>
        <a class="quick-action" href="/backup">
          <div class="quick-action-icon purple">â˜ï¸</div>
          <div class="quick-action-text">å¤‡ä»½æ¢å¤</div>
        </a>
      </div>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="card-title">ğŸ“œ æœ€è¿‘è¿è¡Œ</div>
      <a class="btn btn-secondary btn-sm" href="/runs">æŸ¥çœ‹å…¨éƒ¨</a>
    </div>
    {% if recent_runs|length == 0 %}
      <div class="empty-state">
        <div class="empty-state-icon">ğŸ•’</div>
        <div class="empty-state-title">æš‚æ— è¿è¡Œè®°å½•</div>
        <div class="empty-state-text">å»ä»»åŠ¡é¡µå‘èµ·ä¸€æ¬¡â€œè¿è¡Œä¸€æ¬¡â€è¯•è¯•ã€‚</div>
        <a class="btn btn-primary" href="/tasks">å‰å¾€ä»»åŠ¡é…ç½®</a>
      </div>
    {% else %}
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>run_id</th>
              <th>ä»»åŠ¡</th>
              <th>è´¦å·</th>
              <th>çŠ¶æ€</th>
              <th>å¼€å§‹</th>
              <th>ç»“æŸ</th>
              <th>æ“ä½œ</th>
            </tr>
          </thead>
          <tbody>
            {% for r in recent_runs %}
              <tr>
                <td><code>{{ r.run_id }}</code></td>
                <td>{{ r.task_name }}</td>
                <td>{{ r.account_name }}</td>
                <td>
                  {% if r.status == "running" %}
                    <span class="badge badge-info">è¿è¡Œä¸­</span>
                  {% elif r.status == "success" %}
                    <span class="badge badge-success">æˆåŠŸ</span>
                  {% elif r.status == "failed" %}
                    <span class="badge badge-danger">å¤±è´¥</span>
                  {% elif r.status == "stopped" %}
                    <span class="badge badge-muted">å·²åœæ­¢</span>
                  {% elif r.status == "stopping" %}
                    <span class="badge badge-warning">åœæ­¢ä¸­</span>
                  {% else %}
                    <span class="badge badge-muted">{{ r.status }}</span>
                  {% endif %}
                </td>
                <td class="text-secondary" style="font-size: 12px;">{{ r.started_at or "-" }}</td>
                <td class="text-secondary" style="font-size: 12px;">{{ r.finished_at or "-" }}</td>
                <td><a class="btn btn-secondary btn-sm" href="/runs/{{ r.run_id }}">æŸ¥çœ‹</a></td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    {% endif %}
  </div>
{% endblock %}
