{% extends "base.html" %}
{% set show_nav = true %}
{% set title = "è´¦å· - TG Signer Web" %}

{% block content %}
  {% if error %}
    <div class="alert alert-danger">{{ error }}</div>
  {% endif %}

  <div class="card mb-lg">
    <div class="card-header">
      <div class="card-title">â• æ·»åŠ æ–°è´¦å·</div>
    </div>
    <div class="card-body">
      <form method="post" action="/accounts">
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">è´¦å·åç§°</label>
            <input class="form-input" type="text" name="account_name" placeholder="ä¾‹å¦‚ï¼šä¸»å·ã€å·¥ä½œå·" value="{{ (form.account_name if form else '') }}" required />
            <div class="form-hint">ç”¨äºè¯†åˆ«è´¦å·ï¼Œå¯éšæ„å‘½åã€‚</div>
          </div>
        </div>
        <div class="btn-group">
          <button class="btn btn-primary" type="submit">åˆ›å»ºè´¦å·</button>
        </div>
      </form>
    </div>
  </div>

  {% if items|length == 0 %}
    <div class="empty-state">
      <div class="empty-state-icon">ğŸ‘¤</div>
      <div class="empty-state-title">æš‚æ— è´¦å·</div>
      <div class="empty-state-text">å…ˆåˆ›å»ºä¸€ä¸ªè´¦å·ï¼Œç„¶åè¿›å…¥ Telegram ç™»å½•æµç¨‹ã€‚</div>
    </div>
  {% else %}
    <div class="grid-2">
      {% for a in items %}
        <div class="account-card">
          <div class="account-avatar">{{ (a.account_name[:1] or "A")|upper }}</div>
          <div class="account-info">
            <div class="account-name">{{ a.account_name }}</div>
            <div class="account-meta">åˆ›å»ºæ—¶é—´ï¼š{{ a.created_at }}</div>
            <div class="account-meta">ä¸Šæ¬¡ç™»å½•ï¼š{{ a.last_login_at or "-" }}</div>
            <div class="account-status">
              {% if a.logged_in %}
                <span class="status-dot online"></span>
                <span class="badge badge-success">å·²ç™»å½•</span>
              {% else %}
                <span class="status-dot offline"></span>
                <span class="badge badge-muted">æœªç™»å½•</span>
              {% endif %}
              {% if a.last_error %}
                <span class="badge badge-danger">å¼‚å¸¸</span>
              {% endif %}
            </div>
            {% if a.last_error %}
              <div class="text-danger" style="font-size: 12px; margin-top: 6px;">{{ a.last_error }}</div>
            {% endif %}
          </div>
          <div class="account-actions">
            <a class="btn btn-secondary btn-sm" href="/accounts/{{ a.account_name }}/login">ç™»å½•</a>
            {% if a.logged_in %}
              <a class="btn btn-secondary btn-sm" href="/accounts/{{ a.account_name }}/chats">æœ€è¿‘å¯¹è¯</a>
            {% else %}
              <button class="btn btn-secondary btn-sm" type="button" disabled>æœ€è¿‘å¯¹è¯</button>
            {% endif %}
            <form method="post" action="/accounts/{{ a.account_name }}/logout" style="display: inline;">
              <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />
              <button class="btn btn-danger btn-sm" type="submit">ç™»å‡º</button>
            </form>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
{% endblock %}
